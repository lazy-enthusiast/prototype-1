<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>Travel Planner v18.1 (Layout Fixed)</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Noto+Sans+TC:wght@300;400;500;700&family=Noto+Serif+TC:wght@400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

<style>
/* v18.1 æ¨£å¼ä¿®æ­£èªªæ˜ï¼š
   å·²ä¿®å¾© .header-actions çš„ Flex æ’ç‰ˆï¼Œç¢ºä¿å³ä¸Šè§’æŒ‰éˆ•æ©«å‘ä¸¦æ’ã€‚
*/

/* â›” [ç³»çµ±æ ¸å¿ƒæ¨£å¼] è«‹å‹¿ä¿®æ”¹ */
:root {
    --bg-body: #F5F5F7; 
    --bg-card: #FFFFFF; 
    --text-main: #1D1D1F; 
    --text-sub: #86868B; 
    --accent: #000000;      
    --accent-text: #FFFFFF; 
    --font-main: "Inter", "Noto Sans TC", sans-serif; 
    --border: #E5E5EA; 
    --shadow: 0 4px 12px rgba(0,0,0,0.04);
    --safe-area-bottom: env(safe-area-inset-bottom);
}

* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
body { font-family: var(--font-main); background-color: var(--bg-body); color: var(--text-main); margin: 0; padding: 0; height: 100vh; display: flex; flex-direction: column; overflow: hidden; transition: background 0.3s; }

/* Header æ’ç‰ˆä¿®æ­£ */
header { background-color: rgba(255,255,255,0.85); backdrop-filter: blur(20px); border-bottom: 1px solid rgba(0,0,0,0.05); padding: 0 20px; display: flex; justify-content: space-between; align-items: center; height: 60px; flex-shrink: 0; position: relative; z-index: 200; }
header h1 { margin: 0; font-size: 1.1rem; font-weight: 800; letter-spacing: -0.5px; color: var(--text-main); }

/* [FIXED] ç¢ºä¿æŒ‰éˆ•æ©«å‘æ’åˆ—çš„é—œéµ CSS */
.header-actions { display: flex; align-items: center; gap: 12px; }

.header-btn { font-size: 1.1rem; cursor: pointer; color: var(--text-main); border-radius: 50%; width: 40px; height: 40px; display: flex; justify-content: center; align-items: center; background: rgba(0,0,0,0.05); transition: background 0.2s; }
.header-btn:active { background: rgba(0,0,0,0.1); }

/* æ—¥æœŸé¸æ“‡å™¨ */
.date-selector-container { background: rgba(255,255,255,0.9); backdrop-filter: blur(10px); padding: 5px 0; border-bottom: 1px solid rgba(0,0,0,0.05); width: 100%; flex-shrink: 0; position: relative; z-index: 90; }
.date-selector { display: flex; gap: 12px; overflow-x: auto; scrollbar-width: none; padding: 10px 15px; }
.date-chip { flex: 0 0 auto; min-width: 60px; padding: 10px 0; border-radius: 14px; cursor: pointer; color: var(--text-sub); display: flex; flex-direction: column; align-items: center; justify-content: center; background: #F2F2F7; transition: all 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94); }
.date-chip.active { background: var(--accent); color: var(--accent-text); transform: scale(1.05); box-shadow: 0 4px 10px rgba(0,0,0,0.15); }
.day-num { font-weight: 700; font-size: 1.1rem; line-height: 1; margin-bottom: 2px;} 
.day-week { font-size: 0.7rem; font-weight: 500; opacity: 0.8; }

/* é é¢çµæ§‹ */
main { flex: 1; overflow-y: hidden; position: relative; }
.page { position: absolute; top: 0; left: 0; width: 100%; height: 100%; overflow-y: auto; padding: 20px 0 100px 0; display: none; opacity: 0; transition: opacity 0.2s ease; background-color: var(--bg-body); -webkit-overflow-scrolling: touch; }
.page.active { display: block; opacity: 1; z-index: 10; }
.page-header { padding: 0 20px; margin-bottom: 20px; }
.page-title { font-size: 1.8rem; font-weight: 800; margin: 0; letter-spacing: -0.5px; }

/* è¡Œç¨‹å¡ç‰‡ */
.timeline-container { padding: 10px 20px; max-width: 800px; margin: 0 auto; }
.timeline-item { position: relative; padding-left: 24px; padding-bottom: 25px; border-left: 2px solid #E5E5EA; }
.timeline-item:last-child { border-left: 2px solid transparent; }
.timeline-item::before { content: ''; position: absolute; left: -6px; top: 22px; width: 10px; height: 10px; background: #FFF; border: 2px solid #C7C7CC; border-radius: 50%; z-index: 2; }
.card { background-color: var(--bg-card); border-radius: 18px; padding: 20px; padding-right: 60px; box-shadow: var(--shadow); cursor: pointer; position: relative; transition: transform 0.1s; border: 1px solid transparent; min-height: 85px; display: flex; flex-direction: column; justify-content: center; border-left-width: 5px; }
.card:active { transform: scale(0.98); background: #F2F2F7; }
.card-time { font-size: 0.8rem; color: var(--text-sub); font-weight: 600; margin-bottom: 4px; display: block; }
.card-title { font-size: 1.1rem; font-weight: 700; margin: 0 0 8px 0; line-height: 1.3; }
.tags { display: flex; gap: 6px; flex-wrap: wrap; }
.card-tag { font-size: 0.7rem; background: #F2F2F7; padding: 4px 10px; border-radius: 6px; color: #666; font-weight: 500; }
.card-nav-btn { position: absolute; top: 50%; right: 15px; transform: translateY(-50%); width: 36px; height: 36px; border-radius: 50%; background: #F2F2F7; color: #000; display: flex; justify-content: center; align-items: center; font-size: 1rem; transition: background 0.2s; z-index: 5; }

/* å…¶ä»–æ¨¡çµ„ CSS (ä¿æŒå£“ç¸®ä»¥ç¯€çœç©ºé–“ï¼ŒåŠŸèƒ½ä¸å—å½±éŸ¿) */
#toast { position: fixed; top: 80px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.8); color: white; padding: 12px 24px; border-radius: 30px; font-size: 0.9rem; z-index: 9999; opacity: 0; pointer-events: none; transition: opacity 0.3s; display: flex; align-items: center; gap: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2); font-weight: 500; } #toast.show { opacity: 1; }
.sidebar-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); z-index: 1000; opacity: 0; pointer-events: none; transition: opacity 0.3s; backdrop-filter: blur(4px); } .sidebar-overlay.open { opacity: 1; pointer-events: all; }
.sidebar { position: fixed; top: 0; right: 0; width: 85%; max-width: 300px; height: 100%; background: #FFF; z-index: 1001; transform: translateX(100%); transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1); overflow-y: auto; padding: 25px 20px 100px 20px; box-shadow: -5px 0 20px rgba(0,0,0,0.1); display: flex; flex-direction: column; } .sidebar.open { transform: translateX(0); } .sidebar-section-title { font-size: 0.75rem; color: #8E8E93; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 10px; margin-top: 30px; font-weight: 600; }
.whatsapp-box { background: #E8F5E9; border: 1px solid #C8E6C9; color: #1B5E20; padding: 15px; border-radius: 16px; margin-top: 20px; } .wa-input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid rgba(0,0,0,0.1); border-radius: 8px; font-size: 1rem; background: rgba(255,255,255,0.8); } .wa-btn { width: 100%; background: #25D366; color: white; border: none; padding: 12px; border-radius: 8px; font-weight: bold; cursor: pointer; display: flex; justify-content: center; align-items: center; gap: 8px; font-size: 0.95rem; }
.tool-box { background: #FFFFFF; padding: 15px; border-radius: 16px; border: 1px solid #E5E5EA; margin-bottom: 10px; box-shadow: var(--shadow); } .currency-grid { display: grid; grid-template-columns: 1fr 30px 1fr; align-items: center; gap: 5px; margin-bottom: 8px; } .curr-group { display: flex; flex-direction: column; } .curr-label { font-size: 0.7rem; color: var(--text-sub); font-weight: bold; margin-bottom: 4px; padding-left: 2px;} .curr-input { width: 100%; padding: 12px; border: 1px solid #F2F2F7; border-radius: 10px; font-size: 1.2rem; text-align: center; background: #F9F9F9; font-weight: 600; color: #333; } .rate-info-container { display: flex; justify-content: space-between; align-items: center; margin-top: 8px; font-size: 0.75rem; color: var(--text-sub);} .memo-area { width: 100%; height: 120px; padding: 12px; border: 1px solid #E5E5EA; border-radius: 10px; font-family: inherit; font-size: 0.95rem; resize: none; background: #F9F9F9; line-height: 1.5; }
.weather-main-card { background: linear-gradient(135deg, #1c1c1e, #3a3a3c); color: white; border-radius: 24px; padding: 25px; margin: 0 20px 25px 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.15); text-align: center; position: relative; overflow: hidden;} .weather-header-row { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 10px; } .weather-big-temp { font-size: 3.8rem; font-weight: 700; line-height: 1; letter-spacing: -2px; } .weather-condition { font-size: 1.2rem; font-weight: 500; opacity: 0.9; margin-bottom: 4px; } .weather-hl { font-size: 0.9rem; opacity: 0.7; } .weather-main-icon { font-size: 3.5rem; color: #FFD700; } .weather-tag-badge { position: absolute; top: 15px; right: 15px; background: rgba(255,255,255,0.2); backdrop-filter: blur(5px); padding: 4px 10px; border-radius: 12px; font-size: 0.65rem; font-weight: 600; }
.section-label { padding: 0 20px; font-size: 0.85rem; font-weight: 600; color: #86868B; margin-bottom: 10px; display: block; text-transform: uppercase; letter-spacing: 0.5px; } .hourly-container { display: flex; gap: 12px; overflow-x: auto; padding: 0 20px 20px 20px; scrollbar-width: none; } .hourly-item { flex: 0 0 auto; width: 70px; background: #FFF; border-radius: 16px; padding: 15px 5px; text-align: center; border: 1px solid #E5E5EA; display: flex; flex-direction: column; align-items: center; justify-content: space-between; height: 110px; } .hourly-time { font-size: 0.8rem; color: #666; font-weight: 600; margin-bottom: 5px; } .hourly-icon { font-size: 1.2rem; margin: 5px 0; color: #333; } .hourly-temp { font-size: 1rem; font-weight: 700; color: #000; } .hourly-rain { font-size: 0.65rem; color: #007AFF; font-weight: 500; margin-top: 5px; }
.advice-card { background: #FFF; margin: 0 20px 25px 20px; padding: 20px; border-radius: 18px; border: 1px solid #E5E5EA; display: flex; gap: 15px; align-items: flex-start; } .advice-icon { width: 40px; height: 40px; background: #F2F2F7; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; font-size: 1.1rem; color: #1D1D1F; } .advice-content h4 { margin: 0 0 5px 0; font-size: 1rem; } .advice-content p { margin: 0; font-size: 0.9rem; color: #666; line-height: 1.5; } .weather-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin: 0 20px 30px 20px; } .weather-stat-card { background: #FFF; padding: 15px 20px; border-radius: 16px; border: 1px solid #E5E5EA; display: flex; flex-direction: column; justify-content: center; height: 90px; } .ws-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; } .ws-label { font-size: 0.75rem; color: #8E8E93; text-transform: uppercase; font-weight: 600; } .ws-icon { color: #8E8E93; font-size: 0.9rem; } .ws-value { font-size: 1.4rem; font-weight: 600; color: #1D1D1F; } .ws-sub { font-size: 0.75rem; color: #86868B; margin-top: 2px; }
.shopping-list { padding: 0 20px; } .shop-item { background: #FFF; padding: 16px; border-radius: 12px; margin-bottom: 10px; display: flex; align-items: center; gap: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.02); } .shop-item.checked { opacity: 0.5; background: #F9F9F9; } .shop-item.checked label { text-decoration: line-through; } .shop-item input[type="checkbox"] { width: 22px; height: 22px; accent-color: #000; } .shop-item label { flex: 1; font-size: 1rem; }
.phrase-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 0 20px; } .phrase-card { background: #FFF; border: 1px solid #E5E5EA; padding: 20px 15px; border-radius: 16px; text-align: center; cursor: pointer; transition: all 0.2s; box-shadow: var(--shadow); aspect-ratio: 1.3; display: flex; flex-direction: column; justify-content: center; align-items: center; } .phrase-jp { font-weight: 700; font-size: 1.2rem; margin-bottom: 8px; color: #000; } .phrase-zh { font-size: 0.85rem; color: #8E8E93; } .phrase-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.98); z-index: 5000; display: flex; justify-content: center; align-items: center; opacity: 0; pointer-events: none; transition: opacity 0.3s; } .phrase-overlay.active { opacity: 1; pointer-events: all; } .phrase-content { text-align: center; width: 90%; } .phrase-big { font-size: 3.5rem; font-weight: 800; color: #000; line-height: 1.2; margin-bottom: 20px; word-break: break-all; } .close-phrase { position: absolute; bottom: 80px; left: 50%; transform: translateX(-50%); border: 1px solid #E5E5EA; padding: 12px 40px; border-radius: 30px; color: #000; cursor: pointer; background: #FFF; font-weight: 600; box-shadow: 0 5px 20px rgba(0,0,0,0.1); }
.modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 3000; justify-content: center; align-items: end; backdrop-filter: blur(4px); cursor: pointer; } .modal.open { display: flex; } .modal-content { background: #FFF; color: #000; width: 100%; max-width: 600px; max-height: 90vh; border-radius: 24px 24px 0 0; padding: 0 0 40px 0; overflow-y: auto; animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1); cursor: default; display: flex; flex-direction: column; } .modal-body { padding: 25px; } .modal-info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0; } .modal-label { font-size: 0.7rem; color: #8E8E93; text-transform: uppercase; letter-spacing: 1px; display: block; margin-bottom: 6px; font-weight: 600; } .modal-value { font-size: 1rem; font-weight: 500; color: #1C1C1E; } .modal-note-box { background: #F2F2F7; padding: 20px; border-radius: 12px; margin: 15px 0; } .btn-action { width: 100%; padding: 16px; border-radius: 12px; border: none; font-weight: 600; cursor: pointer; font-size: 1rem; text-align: center; margin-bottom:10px;} .btn-black { background: var(--accent); color: var(--accent-text); } .btn-outline { background: #FFF; border: 1px solid #E5E5EA; color: #000; }
nav.bottom-nav { position: fixed; bottom: 0; width: 100%; background-color: rgba(255,255,255,0.95); display: flex; justify-content: space-around; padding: 10px 0 calc(10px + var(--safe-area-bottom)) 0; border-top: 1px solid rgba(0,0,0,0.1); z-index: 100; backdrop-filter: blur(10px); } .nav-item { color: #C7C7CC; text-align: center; font-size: 0.65rem; cursor: pointer; width: 25%; transition: color 0.2s; } .nav-item i { display: block; font-size: 1.4rem; margin-bottom: 4px; } .nav-item.active { color: var(--accent); }
.info-card { background: #FFF; padding: 20px; border-radius: 16px; margin: 0 20px 15px 20px; border: 1px solid #E5E5EA; box-shadow: var(--shadow); } .info-row { display: flex; gap: 15px; margin-bottom: 15px; align-items: flex-start; font-size: 0.95rem; color: #333; } .info-icon { width: 24px; text-align: center; color: var(--text-sub); } .contact-container { display: flex; align-items: center; gap: 10px; flex-wrap: wrap; margin-top: 6px; } .btn-icon-sm { width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; text-decoration: none; font-size: 1rem; cursor: pointer; transition: transform 0.1s; } .btn-call { background: #E8F5E9; color: #2E7D32; border: 1px solid #C8E6C9; }
.filter-bar-container { padding: 0 20px 15px 20px; position: sticky; top: 0; z-index: 50; background: var(--bg-body); overflow-x: auto; white-space: nowrap; scrollbar-width: none; } .filter-chip { display: inline-block; padding: 8px 18px; margin-right: 8px; background: #FFF; border: 1px solid #E5E5EA; border-radius: 20px; font-size: 0.9rem; color: #666; cursor: pointer; transition: all 0.2s; } .filter-chip.active { background: var(--accent); color: var(--accent-text); border-color: var(--accent); }
.inspire-card { background: #FFF; border: 1px solid #E5E5EA; border-radius: 12px; padding: 20px; color: #444; position: relative; display: block; margin-bottom: 15px;} .inspire-card.hidden { display: none; } .inspire-badge { background: var(--accent); color: var(--accent-text); padding: 4px 10px; border-radius: 6px; font-size: 0.7rem; font-weight: bold; position: absolute; top: -10px; left: 15px; }
</style>
</head>
<body>

<script>
// --- 1. è¨­è¨ˆèªè¨€ (è¨­è¨ˆæ‚¨çš„ App é¢¨æ ¼) ---
const THEME_CONFIG = {
    // ä¸»è‰²èª¿ï¼šå½±éŸ¿æŒ‰éˆ•ã€é¸å–æ—¥æœŸã€å¼·èª¿æ–‡å­—
    // æ«»èŠ±ç²‰: "#FF799A", å‚³çµ±è—: "#1A237E", æŠ¹èŒ¶ç¶ : "#556B2F", é»‘è‰²(é è¨­): "#000000"
    accentColor: "#000000",
    
    // èƒŒæ™¯è‰²ï¼šæ•´å€‹ App çš„åº•è‰²
    // æ·ºç°(é è¨­): "#F5F5F7", ç±³ç™½: "#FAF8F5", ç´”ç™½: "#FFFFFF"
    backgroundColor: "#F5F5F7",
    
    // å­—é«”é¢¨æ ¼ï¼š
    // é»‘é«” (ç¾ä»£/é è¨­): '"Inter", "Noto Sans TC", sans-serif'
    // å®‹é«” (å¤å…¸/æ–‡å­¸): '"Noto Serif TC", serif'
    fontFamily: '"Inter", "Noto Sans TC", sans-serif'
};

// --- 2. è¡Œç¨‹æ—¥æœŸè¨­å®š ---
const CONFIG = {
    startDate: "2026-01-07" // æ ¼å¼ï¼šYYYY-MM-DD
};

// --- 3. è©³ç´°è¡Œç¨‹è³‡æ–™ ---
const USER_ITINERARY = {
    "day1": { 
        "events": [
            { time: "14:00", title: "æŠµé” & Check-in", type: "ä½å®¿", price: "-", open_hours: "24H", address: "Dormy Inn Premium Kyoto", address_jp: "äº¬éƒ½å¸‚ä¸‹äº¬åŒºæ±å¡©å°è·¯ç”º558-8", coords: [34.9868, 135.7599], note: "æ©Ÿå ´å·´å£«ç›´é”ã€‚", tags: ["ç§»å‹•"] },
            { time: "16:00", title: "äº¬éƒ½å¡”", type: "æ™¯é»", price: "Â¥800", open_hours: "10-21", address: "Kyoto Tower", address_jp: "äº¬éƒ½ã‚¿ãƒ¯ãƒ¼", coords: [34.9875, 135.7594], note: "çœ‹æ—¥è½çš„å¥½åœ°æ–¹ã€‚", tags: ["åœ°æ¨™"] }
        ],
        "inspiration": [{title:"å‚™æ¡ˆï¼šAEON Mall", tag:"RAINY", note:"è¶…å¤§è³¼ç‰©ä¸­å¿ƒã€‚"}], 
        "shopping": ["ICOCA å¡"] 
    },
    // å¦‚éœ€æ›´å¤šå¤©æ•¸ï¼Œè«‹è¤‡è£½ day1 çš„æ ¼å¼ä¿®æ”¹ day2, day3...
};
</script>

<div id="toast"><i class="fa-solid fa-circle-check"></i> <span id="toast-msg">Action Completed</span></div>
<header>
    <h1>KYOTO <span style="font-weight:300; opacity:0.5;">PLANNER</span></h1>
    <div class="header-actions">
        <div class="header-btn" onclick="openTranslate()"><i class="fa-solid fa-language"></i></div>
        <div class="header-btn" onclick="toggleSidebar()"><i class="fa-solid fa-bars"></i></div>
    </div>
</header>
<div class="sidebar-overlay" id="sidebar-overlay" onclick="toggleSidebar()"></div>
<div class="sidebar" id="sidebar">
    <div class="whatsapp-box">
        <div style="font-weight:bold; margin-bottom:5px;"><i class="fa-brands fa-whatsapp"></i> å®‰å…¨ Check-in</div>
        <input type="tel" id="wa-phone" class="wa-input" placeholder="å°æ–¹é›»è©± (å¦‚ 85291234567)">
        <button class="wa-btn" id="wa-btn" onclick="sendWhatsApp()"><i class="fa-solid fa-paper-plane"></i> ç™¼é€ä½ç½®</button>
    </div>
    <div class="sidebar-section-title">å·¥å…·ç®±</div>
    <div class="tool-box">
        <div style="font-weight:bold; margin-bottom:15px;">åŒ¯ç‡ (JPY â‡„ HKD)</div>
        <div class="currency-grid">
            <div class="curr-group"><span class="curr-label">JPY</span><input type="number" id="curr-jpy" class="curr-input" placeholder="0" oninput="convertCurrency()"></div>
            <div class="curr-icon"><i class="fa-solid fa-right-left"></i></div>
            <div class="curr-group"><span class="curr-label">HKD</span><input type="number" id="curr-hkd" class="curr-input" placeholder="0" readonly></div>
        </div>
        <div class="rate-info-container">
            <div id="rate-status" class="rate-status">è¼‰å…¥ä¸­...</div>
            <div style="display:flex; gap:10px;"><span onclick="fetchRates(true)" style="color:#007AFF; cursor:pointer;">åˆ·æ–°</span></div>
        </div>
    </div>
    <div class="tool-box">
        <div style="font-weight:bold; margin-bottom:10px;">éš¨æ‰‹è¨˜</div>
        <textarea id="quick-memo" class="memo-area" placeholder="ç­†è¨˜..." oninput="saveMemo()"></textarea>
    </div>
</div>
<div id="phrase-overlay" class="phrase-overlay" onclick="closePhrase()">
    <div class="phrase-content"><div id="overlay-jp" class="phrase-big"></div><div id="overlay-zh" class="phrase-sub"></div></div>
    <div class="close-phrase">é—œé–‰</div>
</div>
<div class="date-selector-container"><div class="date-selector" id="date-selector"></div></div>
<main>
    <div id="page-itinerary" class="page active"><div class="timeline-container" id="timeline-container"></div></div>
    <div id="page-inspiration" class="page">
        <div class="filter-bar-container">
            <span class="filter-chip active" onclick="filterInspiration('all', this)">å…¨éƒ¨</span>
            <span class="filter-chip" onclick="filterInspiration('RAINY', this)">â˜” é›¨å¤©</span>
            <span class="filter-chip" onclick="filterInspiration('TIRED', this)">â˜• ä¼‘æ¯</span>
            <span class="filter-chip" onclick="filterInspiration('PHOTO', this)">ğŸ“· æ‹ç…§</span>
        </div>
        <div id="inspiration-container" class="inspiration-grid"></div>
    </div>
    <div id="page-shopping" class="page"><div class="page-header"><h2 class="page-title">è³¼ç‰©æ¸…å–®</h2></div><div id="shopping-container" class="shopping-list"></div></div>
    <div id="page-weather" class="page">
        <div id="weather-content"><div style="text-align:center; padding:50px;"><i class="fa-solid fa-spinner fa-spin"></i></div></div>
        <div id="weather-details-container" style="display:none;">
            <span class="section-label">ä»Šæ—¥æ™‚æ®µé å ± (3å°æ™‚)</span>
            <div class="hourly-container" id="weather-hourly"></div>
            <span class="section-label" style="margin-top:10px;">æ—…è¡Œè€…å»ºè­°</span>
            <div class="advice-card">
                <div class="advice-icon"><i class="fa-solid fa-shirt"></i></div>
                <div class="advice-content"><h4>ç©¿æ­æŒ‡å—</h4><p id="weather-advice-text">è¼‰å…¥ä¸­...</p></div>
            </div>
            <span class="section-label">è©³ç´°æ•¸æ“š</span>
            <div class="weather-grid">
                <div class="weather-stat-card"><div class="ws-row"><span class="ws-label">æ¿•åº¦</span><i class="fa-solid fa-droplet ws-icon"></i></div><div class="ws-value" id="ws-humidity">--%</div><div class="ws-sub">äº¬éƒ½ç›†åœ°æ˜“æ¿•å†·</div></div>
                <div class="weather-stat-card"><div class="ws-row"><span class="ws-label">ç´«å¤–ç·š</span><i class="fa-solid fa-sun ws-icon"></i></div><div class="ws-value" id="ws-uv">--</div><div class="ws-sub">ç­‰ç´š</div></div>
                <div class="weather-stat-card"><div class="ws-row"><span class="ws-label">æ—¥å‡º</span><i class="fa-regular fa-clock ws-icon"></i></div><div class="ws-value" id="ws-sunrise">--:--</div></div>
                <div class="weather-stat-card"><div class="ws-row"><span class="ws-label">æ—¥è½</span><i class="fa-solid fa-moon ws-icon"></i></div><div class="ws-value" id="ws-sunset">--:--</div></div>
            </div>
            <div style="text-align:center; padding-bottom:30px; color:#AAA; font-size:0.75rem;">è³‡æ–™ä¾†æº: Open-Meteo <span id="data-source-tag"></span></div>
        </div>
    </div>
    <div id="page-info" class="page">
        <div class="page-header"><h2 class="page-title">æ—…ç¨‹è³‡è¨Š</h2></div>
        <div class="info-card">
            <div style="font-weight:bold; margin-bottom:15px; border-bottom:1px solid #EEE; padding-bottom:10px;">ä½å®¿</div>
            <div class="info-row"><div class="info-icon"><i class="fa-solid fa-hotel"></i></div><div><span class="info-label">é…’åº—</span><div>Dormy Inn Premium Kyoto</div></div></div>
            <div class="info-row"><div class="info-icon"><i class="fa-solid fa-location-dot"></i></div><div><span class="info-label">åœ°å€</span><div>äº¬éƒ½å¸‚ä¸‹äº¬å€æ±å¡©å°è·¯ç”º 558-8</div><button class="nav-link" style="margin-top:5px; padding:5px 10px; border:1px solid #DDD; background:#FFF; border-radius:4px;" onclick="copyToClipboard('äº¬éƒ½å¸‚ä¸‹äº¬å€æ±å¡©å°è·¯ç”º 558-8')">è¤‡è£½åœ°å€</button></div></div>
             <div class="info-row"><div class="info-icon"><i class="fa-solid fa-phone"></i></div><div><span class="info-label">é›»è©±</span><div class="contact-container"><span style="margin-right:10px;">+81-75-371-5489</span><a href="javascript:void(0)" onclick="callNumber('+81753715489')" class="btn-icon-sm btn-call"><i class="fa-solid fa-phone"></i></a></div></div></div>
        </div>
        <div class="info-card">
            <div style="font-weight:bold; margin-bottom:15px; border-bottom:1px solid #EEE; padding-bottom:10px;">ç·Šæ€¥</div>
            <div class="info-row"><div class="info-icon"><i class="fa-solid fa-shield-halved"></i></div><div style="width:100%; display:flex; justify-content:space-between; align-items:center;"><div><span class="info-label">è­¦å¯Ÿå±€</span><span>110</span></div><a href="javascript:void(0)" onclick="callNumber('110')" class="btn-icon-sm btn-call"><i class="fa-solid fa-phone"></i></a></div></div>
            <div class="info-row"><div class="info-icon"><i class="fa-solid fa-truck-medical"></i></div><div style="width:100%; display:flex; justify-content:space-between; align-items:center;"><div><span class="info-label">æ•‘è­· / ç«è­¦</span><span>119</span></div><a href="javascript:void(0)" onclick="callNumber('119')" class="btn-icon-sm btn-call"><i class="fa-solid fa-phone"></i></a></div></div>
        </div>
    </div>
</main>
<nav class="bottom-nav">
    <div class="nav-item active" onclick="switchMainPage('itinerary', this)"><i class="fa-regular fa-calendar-days"></i><span>è¡Œç¨‹</span></div>
    <div class="nav-item" onclick="switchMainPage('inspiration', this)"><i class="fa-regular fa-compass"></i><span>éˆæ„Ÿ</span></div>
    <div class="nav-item" onclick="switchMainPage('shopping', this)"><i class="fa-solid fa-bag-shopping"></i><span>æ¡è²·</span></div>
    <div class="nav-item" onclick="switchMainPage('weather', this)"><i class="fa-solid fa-cloud-sun"></i><span>å¤©æ°£</span></div>
    <div class="nav-item" onclick="switchMainPage('info', this)"><i class="fa-solid fa-sliders"></i><span>è³‡è¨Š</span></div>
</nav>
<div id="detail-modal" class="modal">
    <div class="modal-content">
        <div style="position:absolute; top:15px; right:15px; font-size:1.5rem; cursor:pointer; width:36px; height:36px; background:#F2F2F7; border-radius:50%; display:flex; align-items:center; justify-content:center;" onclick="closeModal()">Ã—</div>
        <div id="modal-mini-map"></div>
        <div class="modal-body">
            <div style="margin-bottom:20px;"><span class="modal-label" id="modal-type">Type</span><h2 id="modal-title" style="margin:0; font-size:1.6rem;">Title</h2></div>
            <div class="modal-info-grid">
                <div><span class="modal-label">æ™‚é–“</span><span class="modal-value" id="modal-time"></span></div>
                <div><span class="modal-label">é ç®—</span><span class="modal-value" id="modal-price"></span></div>
                <div><span class="modal-label">é–‹æ”¾æ™‚é–“</span><span class="modal-value" id="modal-open-hours"></span></div>
                <div><span class="modal-label">åœ°å€</span><span class="modal-value" id="modal-address-short" style="font-size:0.9rem;"></span></div>
            </div>
            <div class="modal-label">å‚™è¨»</div><div class="modal-note-box"><div id="modal-note" class="modal-note-content"></div></div>
            <div class="modal-actions" id="modal-actions"></div>
        </div>
    </div>
</div>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
// --- [System Core] Logic Implementation ---
function applyTheme() {
    const root = document.documentElement;
    if(THEME_CONFIG.accentColor) {
        root.style.setProperty('--accent', THEME_CONFIG.accentColor);
    }
    if(THEME_CONFIG.backgroundColor) root.style.setProperty('--bg-body', THEME_CONFIG.backgroundColor);
    if(THEME_CONFIG.fontFamily) root.style.setProperty('--font-main', THEME_CONFIG.fontFamily);
}
function generateScheduleData() {
    const dates = {};
    const baseDate = new Date(CONFIG.startDate);
    const weekDays = ["é€±æ—¥", "é€±ä¸€", "é€±äºŒ", "é€±ä¸‰", "é€±å››", "é€±äº”", "é€±å…­"];
    for(let i=0; i<8; i++) {
        const d = new Date(baseDate);
        d.setDate(baseDate.getDate() + i);
        const dayKey = `day${i+1}`;
        const yyyy = d.getFullYear();
        const mm = String(d.getMonth() + 1).padStart(2, '0');
        const dd = String(d.getDate()).padStart(2, '0');
        dates[dayKey] = {
            date: `${yyyy}-${mm}-${dd}`,
            display: dd,
            weekday: weekDays[d.getDay()],
            events: (USER_ITINERARY[dayKey] && USER_ITINERARY[dayKey].events) || [],
            inspiration: (USER_ITINERARY[dayKey] && USER_ITINERARY[dayKey].inspiration) || [],
            shopping: (USER_ITINERARY[dayKey] && USER_ITINERARY[dayKey].shopping) || []
        };
    }
    return dates;
}
applyTheme(); 
const scheduleData = generateScheduleData();
let currentDay = "day1";
let modalMap = null;
let currentEventData = null;
let exchangeRate = 0.053; 
let weatherCache = null;
let shopState = {}; 
function init() { 
    renderDateSelector(); selectDay('day1'); switchMainPage('itinerary', document.querySelector('.nav-item.active')); fetchRates(); fetchWeather();
    if(localStorage.getItem('travelMemo')) document.getElementById('quick-memo').value = localStorage.getItem('travelMemo');
    if(localStorage.getItem('shopState')) shopState = JSON.parse(localStorage.getItem('shopState'));
    document.getElementById('quick-memo').addEventListener('input', function() { localStorage.setItem('travelMemo', this.value); });
}
function showToast(msg) { const t = document.getElementById('toast'); document.getElementById('toast-msg').innerText = msg; t.classList.add('show'); setTimeout(() => t.classList.remove('show'), 2000); }
async function fetchRates(force = false) {
    const statusEl = document.getElementById('rate-status'); statusEl.innerText = 'æ›´æ–°ä¸­...';
    try {
        const res = await fetch('https://cdn.jsdelivr.net/npm/@fawazahmed0/currency-api@latest/v1/currencies/jpy.json');
        const data = await res.json();
        if(data.jpy && data.jpy.hkd) { exchangeRate = data.jpy.hkd; statusEl.innerHTML = `HKD 1 = JPY ${(1/exchangeRate).toFixed(1)}`; convertCurrency(); if(force) showToast("åŒ¯ç‡å·²æ›´æ–°"); }
    } catch(e) { statusEl.innerText = 'é›¢ç·šæ¨¡å¼'; }
}
function convertCurrency() { const jpy = parseFloat(document.getElementById('curr-jpy').value); if(!isNaN(jpy)) { document.getElementById('curr-hkd').value = (jpy * exchangeRate).toFixed(1); } else { document.getElementById('curr-hkd').value = ""; } }
async function fetchWeather() {
    const lat = 35.0116; const lon = 135.7681;
    const targetDateStr = scheduleData[currentDay].date; 
    const today = new Date(); const targetDate = new Date(targetDateStr);
    const diffTime = targetDate - today; const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 
    let url = ""; let isArchive = false;
    if (diffDays >= -1 && diffDays <= 15) { url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&daily=weathercode,temperature_2m_max,temperature_2m_min,precipitation_probability_max,sunrise,sunset,uv_index_max&hourly=temperature_2m,weathercode,precipitation_probability,relative_humidity_2m&timezone=Asia%2FTokyo&forecast_days=16`; } 
    else { isArchive = true; const pastYear = targetDate.getFullYear() - 1; const pastDateStr = targetDateStr.replace(/^\d{4}/, pastYear); url = `https://archive-api.open-meteo.com/v1/archive?latitude=${lat}&longitude=${lon}&start_date=${pastDateStr}&end_date=${pastDateStr}&daily=weathercode,temperature_2m_max,temperature_2m_min,sunrise,sunset&hourly=temperature_2m,weathercode,relative_humidity_2m&timezone=Asia%2FTokyo`; }
    try {
        const res = await fetch(url); const data = await res.json();
        if(isArchive) { if(!data.daily.precipitation_probability_max) data.daily.precipitation_probability_max = [20]; if(!data.daily.uv_index_max) data.daily.uv_index_max = [3]; if(!data.hourly.precipitation_probability) data.hourly.precipitation_probability = new Array(24).fill(0); }
        weatherCache = data; weatherCache.isArchive = isArchive;
        if(document.getElementById('page-weather').classList.contains('active')) renderWeatherModule();
    } catch(e) { console.error(e); document.getElementById('weather-content').innerHTML = "<div style='text-align:center; padding:30px;'>æš«æ™‚ç„¡æ³•å–å¾—å¤©æ°£</div>"; }
}
function renderWeatherModule() {
    const container = document.getElementById('weather-content'); const details = document.getElementById('weather-details-container'); const sourceTag = document.getElementById('data-source-tag');
    if(!weatherCache || !weatherCache.daily) { container.innerHTML = "<div style='text-align:center; padding:30px;'>ç„¡å¤©æ°£è³‡æ–™</div>"; return; }
    let apiIndex = 0;
    if(!weatherCache.isArchive) { const targetDate = scheduleData[currentDay].date; apiIndex = weatherCache.daily.time.indexOf(targetDate); if (apiIndex === -1) { container.innerHTML = `<div style='text-align:center; padding:40px;'>å°šç„¡é å ±</div>`; return; } }
    const d = weatherCache.daily; const code = d.weathercode[apiIndex];
    const wmo = { 0:{i:'fa-sun',t:'æ™´æœ—'}, 1:{i:'fa-cloud-sun',t:'å¤šé›²'}, 2:{i:'fa-cloud-sun',t:'å¤šé›²'}, 3:{i:'fa-cloud',t:'é™°å¤©'}, 45:{i:'fa-smog',t:'éœ§'}, 51:{i:'fa-cloud-rain',t:'æ¯›æ¯›é›¨'}, 61:{i:'fa-cloud-showers-heavy',t:'é™£é›¨'}, 80:{i:'fa-cloud-showers-water',t:'é›·é™£é›¨'}, 95:{i:'fa-bolt',t:'é›·é›¨'} };
    const w = wmo[code] || {i:'fa-cloud',t:'å¤šé›²'};
    const maxTemp = Math.round(d.temperature_2m_max[apiIndex]); const minTemp = Math.round(d.temperature_2m_min[apiIndex]); const rainProb = d.precipitation_probability_max ? d.precipitation_probability_max[apiIndex] : 0; const tagText = weatherCache.isArchive ? "æ­·å²å¹³å‡ (å»å¹´)" : "å³æ™‚é å ±";
    container.innerHTML = `<div class="weather-main-card"><div class="weather-tag-badge">${tagText}</div><div class="weather-header-row"><div><div class="weather-condition"><i class="fa-solid fa-location-arrow" style="font-size:0.8rem;"></i> äº¬éƒ½ Kyoto</div><div class="weather-hl">H:${maxTemp}Â° L:${minTemp}Â°</div></div><div class="weather-main-icon" style="color:#FFD700"><i class="fa-solid ${w.i}"></i></div></div><div class="weather-big-temp">${maxTemp}Â°</div><div style="font-weight:500;">${w.t} â€¢ é™é›¨ ${rainProb}%</div></div>`;
    const hContainer = document.getElementById('weather-hourly'); hContainer.innerHTML = '';
    const startHour = weatherCache.isArchive ? 0 : apiIndex * 24; 
    [9, 12, 15, 18, 21].forEach(hour => {
        const idx = startHour + hour;
        if(weatherCache.hourly.time[idx] || (weatherCache.isArchive && idx < 24)) {
            const hTemp = Math.round(weatherCache.hourly.temperature_2m[idx]); const hRain = weatherCache.hourly.precipitation_probability ? weatherCache.hourly.precipitation_probability[idx] : 0; const hCode = weatherCache.hourly.weathercode[idx]; const hw = wmo[hCode] || {i:'fa-cloud'};
            hContainer.innerHTML += `<div class="hourly-item"><div class="hourly-time">${hour}:00</div><div class="hourly-icon"><i class="fa-solid ${hw.i}"></i></div><div class="hourly-temp">${hTemp}Â°</div><div class="hourly-rain">${hRain > 20 ? hRain + '%' : ''}</div></div>`;
        }
    });
    let advice = "";
    if (rainProb > 40) advice += "æ”œå¸¶é›¨å…·ï¼šé™é›¨æ©Ÿç‡é«˜ï¼Œè«‹éš¨èº«æ”œå¸¶æŠ˜å‚˜ã€‚<br>"; if (maxTemp < 5) advice += "æ¥µå¯’ä¿æš–ï¼šå»ºè­°ç©¿è‘—ç¾½çµ¨æœã€åœå·¾ã€æ‰‹å¥—ï¼Œä¸¦ä½¿ç”¨æš–æš–åŒ…ã€‚<br>"; else if (maxTemp < 12) advice += "æ´‹è”¥ç©¿æ­ï¼šæ—©æ™šæº«å·®å¤§ï¼Œå»ºè­°å¤§è¡£æ­é…ç™¼ç†±è¡£ã€‚<br>"; else advice += "èˆ’é©æ¶¼çˆ½ï¼šç©¿è‘—è¼•ä¾¿å¤–å¥—å³å¯ã€‚<br>"; if (d.uv_index_max && d.uv_index_max[apiIndex] > 5) advice += "æ³¨æ„é˜²æ›¬ï¼šç´«å¤–ç·šè¼ƒå¼·ã€‚";
    document.getElementById('weather-advice-text').innerHTML = advice || "å¤©æ°£èˆ’é©ï¼Œé©åˆæ—…éŠçš„ä¸€å¤©ï¼";
    const noonIdx = startHour + 12; document.getElementById('ws-humidity').innerText = weatherCache.hourly.relative_humidity_2m[noonIdx] + '%'; document.getElementById('ws-uv').innerText = d.uv_index_max ? d.uv_index_max[apiIndex] : "-"; document.getElementById('ws-sunrise').innerText = d.sunrise[apiIndex].split('T')[1]; document.getElementById('ws-sunset').innerText = d.sunset[apiIndex].split('T')[1];
    sourceTag.innerText = weatherCache.isArchive ? "(æ­·å²å›æº¯æ¨¡å¼)" : "(å³æ™‚é å ±)"; details.style.display = 'block';
}
function toggleSidebar() { document.getElementById('sidebar').classList.toggle('open'); document.getElementById('sidebar-overlay').classList.toggle('open'); }
function openTranslate() { window.open("https://translate.google.com/?sl=auto&tl=zh-TW", "_blank"); }
function switchMainPage(pageId, navEl) { document.querySelectorAll('.page').forEach(p => p.classList.remove('active')); document.getElementById('page-' + pageId).classList.add('active'); document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active')); if(navEl) navEl.classList.add('active'); const ds = document.querySelector('.date-selector-container'); if(pageId === 'info') ds.style.display = 'none'; else ds.style.display = 'block'; if(pageId === 'weather') fetchWeather(); }
function sendWhatsApp() { let phone = document.getElementById('wa-phone').value.replace(/\D/g, ''); if(!phone) { alert("è«‹è¼¸å…¥é›»è©±"); return; } if (navigator.geolocation) { navigator.geolocation.getCurrentPosition((pos) => { const mapLink = `https://www.google.com/maps/search/?api=1&query=${pos.coords.latitude},${pos.coords.longitude}`; window.location.href = `https://wa.me/${phone}?text=${encodeURIComponent("æˆ‘å¹³å®‰æŠµé”äº†ï¼ä½ç½®ï¼š" + mapLink)}`; }); } else alert("ç„¡æ³•å®šä½"); }
function callNumber(num) { window.location.href = `tel:${num}`; }
function copyToClipboard(text) { navigator.clipboard.writeText(text).then(() => { showToast("å·²è¤‡è£½"); }); }
function searchGmail(query) { window.open(`https://mail.google.com/mail/u/0/#search/${encodeURIComponent(query)}`, '_blank'); }
function openModal(data) { currentEventData = data; document.getElementById('modal-title').innerText = data.title; document.getElementById('modal-type').innerText = data.type; document.getElementById('modal-time').innerText = data.time; document.getElementById('modal-price').innerText = data.price; document.getElementById('modal-open-hours').innerText = data.open_hours || "å¾…ç¢ºèª"; document.getElementById('modal-address-short').innerText = data.address; document.getElementById('modal-note').innerText = data.note; const actionsContainer = document.getElementById('modal-actions'); actionsContainer.innerHTML = ''; const addr = data.address_jp || data.address; actionsContainer.innerHTML += `<button class="btn-action btn-outline" onclick="copyToClipboard('${addr}')"><i class="fa-regular fa-copy"></i> è¤‡è£½åœ°å€</button>`; actionsContainer.innerHTML += `<button class="btn-action btn-black" onclick="openMapQuery('${data.address}')"><i class="fa-solid fa-location-arrow"></i> Google Maps å°èˆª</button>`; if (data.type === 'ç¾é£Ÿ' || data.type === 'æ™šé¤' || data.type === 'åˆé¤' || data.type === 'æ—©é¤') { actionsContainer.innerHTML += `<button class="btn-action btn-outline" onclick="searchGmail('${data.title}')">ğŸ” æœå°‹é ç´„ä¿¡ (Gmail)</button>`; } if (data.type === 'ä½å®¿') { actionsContainer.innerHTML += `<button class="btn-action btn-outline" onclick="showPhrase('${addr}', 'è«‹è¼‰æˆ‘å»é€™è£¡')">ğŸš• é¡¯ç¤ºçš„å£«å¡</button>`; } document.getElementById('detail-modal').classList.add('open'); setTimeout(() => { if(modalMap) modalMap.remove(); modalMap = L.map('modal-mini-map', {zoomControl:false, dragging:false, attributionControl: false}).setView(data.coords, 15); L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png').addTo(modalMap); L.marker(data.coords, {icon: L.divIcon({className:'custom-div-icon',html:"<div style='background:black;width:12px;height:12px;border-radius:50%;border:2px solid white;box-shadow:0 2px 5px rgba(0,0,0,0.3);'></div>",iconSize:[12,12]})}).addTo(modalMap); modalMap.invalidateSize(); }, 150); }
function openMapQuery(address) { window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(address)}`, '_blank'); }
function closeModal() { document.getElementById('detail-modal').classList.remove('open'); }
document.getElementById('detail-modal').addEventListener('click', function(e) { if (e.target === this) closeModal(); });
function renderDateSelector() { const container = document.getElementById('date-selector'); container.innerHTML = ''; Object.keys(scheduleData).forEach(dayKey => { const day = scheduleData[dayKey]; const chip = document.createElement('div'); chip.className = `date-chip`; chip.id = `chip-${dayKey}`; chip.onclick = () => selectDay(dayKey, chip); chip.innerHTML = `<span class="day-num">${day.display}</span><span class="day-week">${day.weekday}</span>`; container.appendChild(chip); }); }
function selectDay(dayKey, chipEl) { currentDay = dayKey; document.querySelectorAll('.date-chip').forEach(c => c.classList.remove('active')); (chipEl || document.getElementById(`chip-${dayKey}`)).classList.add('active'); if(chipEl) chipEl.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' }); renderTimeline(dayKey); renderInspiration(dayKey); renderShopping(dayKey); if(document.getElementById('page-weather').classList.contains('active')) fetchWeather(); }
function renderTimeline(dayKey) { const container = document.getElementById('timeline-container'); container.innerHTML = ''; (scheduleData[dayKey].events || []).forEach(event => { const item = document.createElement('div'); item.className = 'timeline-item'; let tags = event.tags.map(t => `<span class="card-tag">${t}</span>`).join(''); const navBtn = `<div class="card-nav-btn" onclick="event.stopPropagation(); openMapQuery('${event.address}')"><i class="fa-solid fa-location-arrow"></i></div>`; const colorStyle = event.moodColor ? `border-left-color: ${event.moodColor};` : 'border-left-color: transparent;'; item.innerHTML = `<div class="card" style="${colorStyle}" onclick='openModal(${JSON.stringify(event).replace(/'/g, "'")})'>${navBtn}<span class="card-time">${event.time}</span><h3 class="card-title">${event.title}</h3><div class="tags">${tags}</div></div>`; container.appendChild(item); }); if(!scheduleData[dayKey].events.length) container.innerHTML = "<div style='text-align:center; padding:50px; color:#999;'>æœ¬æ—¥ç„¡è¡Œç¨‹ï¼Œè‡ªç”±æ¢ç´¢ï¼</div>"; }
function renderInspiration(dayKey) { const container = document.getElementById('inspiration-container'); container.innerHTML = ''; (scheduleData[dayKey].inspiration || []).forEach(item => { container.innerHTML += `<div class="inspire-card" data-tag="${item.tag}"><div class="inspire-badge">${item.tag}</div><h3>${item.title}</h3><p style="margin:5px 0 0 0; font-size:0.9rem; color:#666;">${item.note}</p></div>`; }); if(!scheduleData[dayKey].inspiration.length) container.innerHTML = "<div style='text-align:center; padding:30px; color:#CCC;'>æœ¬æ—¥ç„¡éˆæ„Ÿç­†è¨˜</div>"; }
function filterInspiration(tag, btn) { document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active')); btn.classList.add('active'); document.querySelectorAll('.inspire-card').forEach(card => { if(tag === 'all' || card.getAttribute('data-tag') === tag) card.classList.remove('hidden'); else card.classList.add('hidden'); }); }
function renderShopping(dayKey) { const container = document.getElementById('shopping-container'); container.innerHTML = ''; const items = scheduleData[dayKey].shopping || []; if(items.length === 0) { container.innerHTML = "<div style='color:#AAA; text-align:center; padding:20px;'>ç„¡å¾…è²·æ¸…å–®</div>"; return; } items.forEach((item, idx) => { const uniqueId = `${dayKey}-${idx}`; const isChecked = shopState[uniqueId] ? 'checked' : ''; const div = document.createElement('div'); div.className = `shop-item ${isChecked ? 'checked' : ''}`; div.innerHTML = `<input type="checkbox" id="${uniqueId}" ${isChecked} onchange="toggleShopItem(this, '${uniqueId}')"><label for="${uniqueId}">${item}</label>`; container.appendChild(div); }); }
function toggleShopItem(checkbox, id) { shopState[id] = checkbox.checked; localStorage.setItem('shopState', JSON.stringify(shopState)); checkbox.closest('.shop-item').classList.toggle('checked'); }
function showPhrase(jp, zh) { document.getElementById('overlay-jp').innerText = jp; document.getElementById('overlay-zh').innerText = zh; document.getElementById('phrase-overlay').classList.add('active'); }
function closePhrase() { document.getElementById('phrase-overlay').classList.remove('active'); }

init();
</script>
</body>
</html>
